// Any copyright is dedicated to the Public Domain.
// http://creativecommons.org/publicdomain/zero/1.0/

package GhostPointerReceiverFail01

type Foo struct {
    field int
}

ghost
decreases
func GhostFunc() {
    p := &Foo{ 42 }
    p.bar1()
    //:: ExpectedOutput(type_error)
    p.bar2() // bar2 is not defined on a ghost pointer
}

// note that the type error refers to the receiver but is (for technical reasons) located at the beginning of the function declaration
//:: ExpectedOutput(type_error)
decreases
func (r gpointer[Foo]) bar1() int { // ghostpointer is only allowed for ghost methods
    r.field = 0
    return 42
}

ghost
decreases
func (r *Foo) bar2() int {
    //:: ExpectedOutput(type_error)
    r.field = 0 // fails since we're trying to modify actual memory
    return r.field
}
